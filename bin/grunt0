#!/usr/bin/env node

'use strict';

process.title = 'grunt';

// 可以加入自己的代码了
console.info('my bin, haha');

// Especially badass external libs.
var findup = require('findup-sync');
var resolve = require('resolve').sync;

// Internal libs. 调用内部文件了

// 引入内部定义的模块,options是对象属性
// 是注册进去的变量
// 从其他目录引入模块
var options = require('../lib/cli').options;
var completion = require('../lib/completion');
var info = require('../lib/info');

// 又是一个库
var path = require('path');

// 这里没有使用single var模式
// 获取当前目录
var basedir = process.cwd();
var gruntpath;

// Do stuff based on CLI options.
if ('completion' in options) {
  // print是暴露的函数名
  completion.print(options.completion);
} else if (options.version) {
  info.version();
} else if (options.gruntfile) { //Note: if both `gruntfile` and `base` are set, use `gruntfile`
  basedir = path.resolve(path.dirname(options.gruntfile));
} else if (options.base) {
  basedir = path.resolve(options.base);
}

try {
  // 读取grunt包
  gruntpath = resolve('grunt', {basedir: basedir});
} catch (ex) {
  gruntpath = findup('lib/grunt.js');
  // No grunt install found!
  if (!gruntpath) {
    if (options.version) { process.exit(); }
    if (options.help) { info.help(); }
    info.fatal('Unable to find local grunt.', 99);
  }
}

// Everything looks good. Require local grunt and run it.
require(gruntpath).cli();
